---
import CookieConsent from '../components/CookieConsent.astro';
import Analytics from '../components/Analytics.astro';

interface Props {
  title: string;
  description?: string;
  image?: string;
  type?: 'website' | 'article';
  publishedDate?: string;
  modifiedDate?: string;
  author?: string;
  canonicalUrl?: string;
  noindex?: boolean;
}

const {
  title,
  description = 'AI-Native Project Management for Developers. Let Claude Code, Cursor, and AI tools manage your projects directly via MCP, API, and CLI. Built by Erold.',
  image = '/og-image.png',
  type = 'website',
  publishedDate,
  modifiedDate,
  author = 'Erold',
  canonicalUrl,
  noindex = false,
} = Astro.props;

const siteUrl = 'https://erold.dev';
const fullTitle = title === 'Erold' ? title : `${title} | Erold`;
const ogImage = image.startsWith('http') ? image : `${siteUrl}${image}`;
const canonical = canonicalUrl || Astro.url.href;

// Structured Data - Organization (enhanced with parent company)
const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "Erold",
  "alternateName": "Erold Dev",
  "description": "AI-Native Project Management Platform for Developers and AI Agents",
  "url": siteUrl,
  "logo": `${siteUrl}/logo.png`,
  "image": `${siteUrl}/og-image.png`,
  "sameAs": [
    "https://github.com/erold-dev",
    "https://twitter.com/erold",
    "https://linkedin.com/company/erold",
    "https://discord.gg/erold"
  ],
  "contactPoint": {
    "@type": "ContactPoint",
    "contactType": "customer service",
    "url": `${siteUrl}/contact`,
    "availableLanguage": ["English", "French", "German"]
  },
  "parentOrganization": {
    "@type": "Organization",
    "name": "Yet Another Artificial Intelligence Company",
    "legalName": "Yet Another Artificial Intelligence Company SARL-S",
    "url": "https://yet.lu",
    "address": {
      "@type": "PostalAddress",
      "addressCountry": "LU",
      "addressLocality": "Luxembourg"
    },
    "taxID": "LU36410809"
  },
  "foundingDate": "2024",
  "areaServed": "Worldwide"
};

// Structured Data - Software Application (enhanced with pricing tiers)
const softwareSchema = {
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "Erold",
  "alternateName": "Yet Project AI PM",
  "description": description,
  "applicationCategory": "DeveloperApplication",
  "applicationSubCategory": "Project Management",
  "operatingSystem": "Web, macOS, Windows, Linux",
  "url": siteUrl,
  "downloadUrl": "https://www.npmjs.com/package/@erold/cli",
  "softwareVersion": "1.0",
  "releaseNotes": `${siteUrl}/changelog`,
  "screenshot": `${siteUrl}/og-image.png`,
  "offers": [
    {
      "@type": "Offer",
      "name": "Free",
      "price": "0",
      "priceCurrency": "USD",
      "description": "1 project, unlimited tasks, 2 team members"
    },
    {
      "@type": "Offer",
      "name": "Pro",
      "price": "5",
      "priceCurrency": "USD",
      "priceSpecification": {
        "@type": "UnitPriceSpecification",
        "price": "5",
        "priceCurrency": "USD",
        "billingDuration": "P1M"
      },
      "description": "Unlimited projects, 10 members included, pay-as-you-go extras"
    }
  ],
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "4.9",
    "ratingCount": "127",
    "bestRating": "5",
    "worstRating": "1"
  },
  "featureList": [
    "MCP Server with 27+ tools for AI assistants",
    "REST API with 68+ endpoints",
    "CLI Tool for terminal workflows",
    "Knowledge Base for AI persistent memory",
    "Claude Code integration",
    "Cursor IDE integration",
    "Windsurf IDE integration",
    "GitHub webhooks and automation",
    "Team collaboration",
    "Time tracking"
  ],
  "keywords": "AI project management, MCP server, Claude Code, Cursor, developer tools"
};

// Structured Data - WebSite with SearchAction
const websiteSchema = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "Erold",
  "alternateName": "Yet Project Documentation",
  "url": siteUrl,
  "potentialAction": {
    "@type": "SearchAction",
    "target": {
      "@type": "EntryPoint",
      "urlTemplate": `${siteUrl}/docs?q={search_term_string}`
    },
    "query-input": "required name=search_term_string"
  }
};

// Structured Data - Breadcrumb (dynamic based on URL)
const pathParts = Astro.url.pathname.split('/').filter(Boolean);
const breadcrumbSchema = pathParts.length > 0 ? {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": siteUrl
    },
    ...pathParts.map((part, index) => ({
      "@type": "ListItem",
      "position": index + 2,
      "name": part.charAt(0).toUpperCase() + part.slice(1).replace(/-/g, ' '),
      "item": `${siteUrl}/${pathParts.slice(0, index + 1).join('/')}`
    }))
  ]
} : null;

// Structured Data - FAQ (for homepage) - expanded with more questions
const faqSchema = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "What is Erold?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Erold is an AI-native project management platform built specifically for developers and AI agents to collaborate. It features MCP server integration, REST API, CLI tool, and a knowledge base that gives AI persistent memory across sessions."
      }
    },
    {
      "@type": "Question",
      "name": "How does Erold integrate with Claude Code?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Erold provides a native MCP (Model Context Protocol) server with 27+ tools that Claude Code can use directly. This allows Claude to create tasks, update progress, access project knowledge, and manage your projects without any copy-paste."
      }
    },
    {
      "@type": "Question",
      "name": "Is Erold free?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Yes! Erold offers a free tier with 1 project and unlimited tasks. Pro is $5/month with pay-as-you-go pricing for extra resources. Only pay for what you use beyond included allocations."
      }
    },
    {
      "@type": "Question",
      "name": "What AI tools does Erold support?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Erold works with any AI tool that supports MCP or REST APIs, including Claude Code, Claude Desktop, Cursor, Windsurf, GitHub Copilot, and custom AI agents. The API-first design ensures compatibility with current and future AI tools."
      }
    },
    {
      "@type": "Question",
      "name": "What is MCP (Model Context Protocol)?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "MCP (Model Context Protocol) is a standard protocol that allows AI assistants to interact with external tools and services. Erold's MCP server provides 27+ tools for task management, knowledge base access, and project operations that AI assistants can use directly."
      }
    },
    {
      "@type": "Question",
      "name": "How is Erold different from Jira, Linear, or Asana?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Erold is built API-first for AI agents, not humans-first with APIs added later. Traditional tools require copy-paste to share context with AI. Erold lets AI assistants read tasks, update progress, and access project knowledge directly through MCP, API, or CLI."
      }
    },
    {
      "@type": "Question",
      "name": "What is the Knowledge Base feature?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "The Knowledge Base is persistent memory for AI assistants. Store project context, coding standards, architecture decisions, and any information AI should remember across sessions. AI can read and write knowledge entries, making it smarter about your specific project over time."
      }
    },
    {
      "@type": "Question",
      "name": "Does Erold have a CLI tool?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Yes! The Yet CLI (npm install -g @erold/cli) provides full task management from your terminal. Create tasks, list projects, mark items done, and integrate with git workflows. Perfect for developers who prefer command-line tools."
      }
    }
  ]
};
---

<!doctype html>
<html lang="en" class="scroll-smooth">
  <head>
    <!-- Essential Meta Tags -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- SEO Meta Tags -->
    <title>{fullTitle}</title>
    <meta name="description" content={description} />
    <meta name="author" content={author} />
    <link rel="canonical" href={canonical} />
    {noindex && <meta name="robots" content="noindex, nofollow" />}

    <!-- Keywords for AI Project Management -->
    <meta name="keywords" content="ai project management, project management for developers, mcp server, claude code integration, cursor project management, ai-native workflow, developer task manager, api project management, cli task manager, ai agent project tracking" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={type} />
    <meta property="og:url" content={canonical} />
    <meta property="og:title" content={fullTitle} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImage} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:site_name" content="Erold" />
    <meta property="og:locale" content="en_US" />
    {publishedDate && <meta property="article:published_time" content={publishedDate} />}
    {modifiedDate && <meta property="article:modified_time" content={modifiedDate} />}

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@erikibolern" />
    <meta name="twitter:creator" content="@erikibolern" />
    <meta name="twitter:title" content={fullTitle} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImage} />

    <!-- Favicon & App Icons -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <meta name="theme-color" content="#2563eb" />
    <meta name="msapplication-TileColor" content="#2563eb" />

    <!-- Fonts - Preconnect for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet" />

    <!-- Preload Critical Assets -->
    <link rel="preload" href="/fonts/CalSans-SemiBold.woff2" as="font" type="font/woff2" crossorigin />

    <!-- Structured Data for SEO and AI -->
    <script type="application/ld+json" set:html={JSON.stringify(organizationSchema)} />
    <script type="application/ld+json" set:html={JSON.stringify(softwareSchema)} />
    <script type="application/ld+json" set:html={JSON.stringify(websiteSchema)} />
    <script type="application/ld+json" set:html={JSON.stringify(faqSchema)} />
    {breadcrumbSchema && <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />}

    <!-- Google Analytics 4 - GDPR Compliant with Consent Mode -->
    <script is:inline>
      // Google Analytics Consent Mode v2 - Default to denied until consent
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}

      // Set default consent state (denied until user accepts)
      gtag('consent', 'default', {
        'analytics_storage': 'denied',
        'ad_storage': 'denied',
        'ad_user_data': 'denied',
        'ad_personalization': 'denied',
        'functionality_storage': 'denied',
        'personalization_storage': 'denied',
        'security_storage': 'granted', // Always granted for security
        'wait_for_update': 500
      });

      // Check for existing cookie consent
      (function() {
        try {
          const consentCookie = document.cookie
            .split('; ')
            .find(row => row.startsWith('cookie_consent='));

          if (consentCookie) {
            const consent = JSON.parse(decodeURIComponent(consentCookie.split('=')[1]));
            if (consent.analytics) {
              gtag('consent', 'update', {
                'analytics_storage': 'granted'
              });
            }
            if (consent.functional) {
              gtag('consent', 'update', {
                'functionality_storage': 'granted',
                'personalization_storage': 'granted'
              });
            }
          }
        } catch (e) {
          // Consent cookie not found or invalid
        }
      })();

      gtag('js', new Date());
      gtag('config', 'G-D4WGC51J8C', {
        'anonymize_ip': true,
        'cookie_flags': 'SameSite=None;Secure',
        'send_page_view': true
      });
    </script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-D4WGC51J8C"></script>
  </head>

  <body class="bg-white text-dark-900 antialiased font-sans selection:bg-primary-100 selection:text-primary-900">
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-primary-600 focus:text-white focus:rounded-lg">
      Skip to main content
    </a>

    <slot />

    <!-- Cookie Consent Banner (GDPR) -->
    <CookieConsent />

    <!-- Analytics Event Tracking -->
    <Analytics />

    <!-- Smooth scroll behavior and other global scripts -->
    <script>
      // Add loaded class for animations
      document.addEventListener('DOMContentLoaded', () => {
        document.body.classList.add('loaded');
      });

      // Intersection Observer for scroll animations
      const observerOptions = {
        root: null,
        rootMargin: '0px',
        threshold: 0.1
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('animate-in');
            observer.unobserve(entry.target);
          }
        });
      }, observerOptions);

      document.querySelectorAll('[data-animate]').forEach(el => {
        observer.observe(el);
      });
    </script>
  </body>
</html>

<style is:global>
  /* Custom font face for Cal Sans (if available) */
  @font-face {
    font-family: 'Cal Sans';
    src: url('/fonts/CalSans-SemiBold.woff2') format('woff2');
    font-weight: 600;
    font-style: normal;
    font-display: swap;
  }

  /* Smooth scrolling */
  html {
    scroll-behavior: smooth;
  }

  /* Focus styles for accessibility */
  :focus-visible {
    outline: 2px solid #2563eb;
    outline-offset: 2px;
  }

  /* Animation base states */
  [data-animate] {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.6s ease-out, transform 0.6s ease-out;
  }

  [data-animate].animate-in {
    opacity: 1;
    transform: translateY(0);
  }

  [data-animate="fade"] {
    transform: none;
  }

  [data-animate="slide-left"] {
    transform: translateX(-20px);
  }

  [data-animate="slide-left"].animate-in {
    transform: translateX(0);
  }

  [data-animate="slide-right"] {
    transform: translateX(20px);
  }

  [data-animate="slide-right"].animate-in {
    transform: translateX(0);
  }

  [data-animate="scale"] {
    transform: scale(0.95);
  }

  [data-animate="scale"].animate-in {
    transform: scale(1);
  }

  /* Staggered animation delays */
  [data-delay="100"] { transition-delay: 100ms; }
  [data-delay="200"] { transition-delay: 200ms; }
  [data-delay="300"] { transition-delay: 300ms; }
  [data-delay="400"] { transition-delay: 400ms; }
  [data-delay="500"] { transition-delay: 500ms; }
  [data-delay="600"] { transition-delay: 600ms; }

  /* Gradient text utility */
  .gradient-text {
    background: linear-gradient(135deg, #2563eb 0%, #7c3aed 50%, #2563eb 100%);
    background-size: 200% auto;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: gradientShift 8s ease infinite;
  }

  @keyframes gradientShift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }

  /* Glassmorphism utility */
  .glass {
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }

  .glass-dark {
    background: rgba(15, 23, 42, 0.8);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }

  /* Custom scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  ::-webkit-scrollbar-track {
    background: #f1f5f9;
  }

  ::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: #94a3b8;
  }

  /* Code block styling */
  pre {
    font-family: 'JetBrains Mono', 'Fira Code', monospace;
  }

  code {
    font-family: 'JetBrains Mono', 'Fira Code', monospace;
  }

  /* Button hover effect */
  .btn-glow {
    position: relative;
    overflow: hidden;
  }

  .btn-glow::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s ease;
  }

  .btn-glow:hover::before {
    left: 100%;
  }
</style>
